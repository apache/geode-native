#! Licensed to the Apache Software Foundation (ASF) under one or more
#! contributor license agreements.  See the NOTICE file distributed with
#! this work for additional information regarding copyright ownership.
#! The ASF licenses this file to You under the Apache License, Version 2.0
#! (the "License"); you may not use this file except in compliance with
#! the License.  You may obtain a copy of the License at
#!
#!      http://www.apache.org/licenses/LICENSE-2.0
#!
#! Unless required by applicable law or agreed to in writing, software
#! distributed under the License is distributed on an "AS IS" BASIS,
#! WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#! See the License for the specific language governing permissions and
#! limitations under the License.

#@ load("templates.lib.yml",
#@      "git_resource",
#@      "gci_resource",
#@      "extends_build",
#@      "image_family_name",
#@      "registry_image_resource",
#@      "build_job_name",
#@      "packer_job",
#@      "packer_job_name",
#@      "docker_job",
#@      "docker_job_name",
#@      "update_pipeline_job",
#@      "update_pipeline_job_name",
#@      "version_source_job",
#@      "version_source_job_name")
#@ load("@ytt:data", "data")
#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:struct", "struct")
#@ load("@ytt:template", "template")

#@overlay/match by=overlay.all
---

jobs:
  #@overlay/match by="name", missing_ok=True
  #@overlay/append
  - #@ update_pipeline_job("pr")

  #@overlay/match missing_ok=True
groups:
  - name: builds
    jobs:
      #@ for build in data.values.builds:
      #@ for/end config in data.values.configs:
      - #@ build_job_name(extends_build(build), config)
      #@ end
  - name: meta
    jobs:
      - #@ update_pipeline_job_name()
  - name: all
    jobs:
      #@ for build in data.values.builds:
      #@ for/end config in data.values.configs:
      - #@ build_job_name(extends_build(build), config)
      #@ end
      - #@ update_pipeline_job_name()
